var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function n(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),ImageVaultInsertMedia;!function(e){var t=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t}(MessageEvent);e.InsertSuccessMessageEvent=t;var i=function(){};e.InsertResponse=i;var n=function(){};e.MediaConversion=n;var s=function(){};e.PublishDetails=s;var o=function(){};e.Config=o;var a=function(){function e(e,t){var i=this;if(!e.is("iframe"))throw"The jQuery element must be an iframe";this.$dom=e,this.postMessageCallbackReceived=!1,this.pingOn=!1,this.containerWindow=this.$dom[0].contentWindow,$(document).ready(function(){var e=i;if(window.addEventListener)window.addEventListener("message",function(t){e.messageReceiver(t)},!1);else{if(!window.attachEvent)throw"Cannot attachEvent/addEventListener, not supported by browser";window.attachEvent("message",function(t){e.messageReceiver(t)})}i.setupCallback(),i.setupComplete=!0}),this.readConfig(t)}return e.prototype.readConfig=function(e){var t=null;if(null==e.origin){var i=document.createElement("a");i.href=e.imageVaultUiUrl,e.origin=i.protocol+"//"+i.hostname+(i.port?":"+i.port:"")}if(e.publishingSource||(t="Publish source must be configured"),null!=t&&e.error)e.error(null,t);else if(null!=t)throw t;this.config=e},e.prototype.openImageVault=function(){var e=this.config;e.formatId||(e.formatId=0);var t="mediaurlbase="+e.mediaUrlBase+"&ensurepublishingsource="+e.publishingSource+(e.uiLang?"&uiLang="+e.uiLang:"")+(e.pageLang?"&pagelang="+e.pageLang:"")+(e.insertMultiple?"&insertmultiple="+e.insertMultiple:"")+"&formatId="+e.formatId,i=e.publishDetails;i&&(t+=(i.text?"&publishdetails.Text="+i.text:"")+(i.url?"&publishdetails.Url="+i.url:"")+(i.groupId?"&publishdetails.GroupId="+i.groupId:"")),this.$dom.attr("src",this.config.imageVaultUiUrl+"?"+t),this.setupComplete&&(this.postMessageCallbackReceived=!1,this.setupCallback())},e.prototype.setupCallback=function(){var e=this;if(this.postMessageCallbackReceived)return!0;if(this.containerWindow.postMessage){try{this.containerWindow.postMessage("init",this.config.origin)}catch(e){}setTimeout(function(){e.setupCallback()},1e3)}return!1},e.prototype.ping=function(){var e=this;if(this.pingOn){if(this.containerWindow.postMessage)try{this.containerWindow.postMessage("ping",this.config.origin)}catch(e){}setTimeout(function(){e.ping()},1e3)}},e.prototype.messageReceiver=function(e){var t=this;if(e.origin===this.config.origin){if("initReceived"===e.data)return this.postMessageCallbackReceived=!0,this.pingOn=!0,setTimeout(function(){t.ping()},1e3),void(this.config.debug&&this.config.debug(e));if("pong"!==e.data)return"close"===e.data?(this.pingOn=!1,void(this.config.close&&this.config.close(e))):void(this.config.success&&(e.response=JSON.parse(e.data),this.config.success(e)));this.config.debug&&this.config.debug(e)}else this.config.error&&this.config.error(e,"origin does not match")},e}();e.InsertMedia=a}(ImageVaultInsertMedia||(ImageVaultInsertMedia={})),$.fn.extend({imageVaultInsertMedia:function(e){var t=this.get(0);return t.imageVaultInsertMedia?t.imageVaultInsertMedia.readConfig(e):t.imageVaultInsertMedia=new ImageVaultInsertMedia.InsertMedia(this,e),t.imageVaultInsertMedia.openImageVault(),!0}});
//# sourceMappingURL=insertmedia.min.js.map
